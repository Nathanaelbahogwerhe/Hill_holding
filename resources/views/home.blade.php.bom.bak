@extends('layouts.app')

@section('content')
<div class="container py-5 text-light" style="background-color: #0d0d0d;">
    <h1 class="text-center mb-5" style="color: gold;">Tableau de bord</h1>

    <div class="row g-4" id="dashboard-updates">
        <!-- Les mises à jour s’afficheront ici dynamiquement -->
    </div>
</div>
@endsection

@push('scripts')
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fonction de récupération des dernières mises à jour
    function fetchUpdates() {
        fetch("{{ route('dashboard.updates') }}")
            .then(response => response.json())
            .then(data => {
                let html = '';

                // ????? Nouveaux employés
                if (data.employees && data.employees.length > 0) {
                    html += `
                    <div class="col-md-6">
                        <div class="card bg-dark border-gold shadow-lg">
                            <div class="card-header text-gold">?? Nouveaux employés</div>
                            <div class="card-body">`;
                    data.employees.forEach(e => {
                        html += `<p><strong>${e.first_name} ${e.last_name}</strong> — ajouté le ${new Date(e.created_at).toLocaleDateString()}</p>`;
                    });
                    html += `</div></div></div>`;
                }

                // ?? Nouveaux départements
                if (data.departments && data.departments.length > 0) {
                    html += `
                    <div class="col-md-6">
                        <div class="card bg-dark border-gold shadow-lg">
                            <div class="card-header text-gold">?? Départements récents</div>
                            <div class="card-body">`;
                    data.departments.forEach(d => {
                        html += `<p><strong>${d.name}</strong> — créé le ${new Date(d.created_at).toLocaleDateString()}</p>`;
                    });
                    html += `</div></div></div>`;
                }

                // ?? Notes administratives
                if (data.notes && data.notes.length > 0) {
                    html += `
                    <div class="col-md-6">
                        <div class="card bg-dark border-gold shadow-lg">
                            <div class="card-header text-gold">?? Notes administratives</div>
                            <div class="card-body">`;
                    data.notes.forEach(n => {
                        html += `<p><strong>${n.title}</strong> — publiée le ${new Date(n.created_at).toLocaleDateString()}</p>`;
                    });
                    html += `</div></div></div>`;
                }

                // ?? Paiements récents
                if (data.payments && data.payments.length > 0) {
                    html += `
                    <div class="col-md-6">
                        <div class="card bg-dark border-gold shadow-lg">
                            <div class="card-header text-gold">?? Paiements / Salaires</div>
                            <div class="card-body">`;
                    data.payments.forEach(p => {
                        html += `<p><strong>Paiement #${p.id}</strong> — Montant : ${p.amount ?? 'N/A'} — ${new Date(p.created_at).toLocaleDateString()}</p>`;
                    });
                    html += `</div></div></div>`;
                }

                document.getElementById('dashboard-updates').innerHTML = html || `
                    <div class="text-center text-secondary">
                        Aucune mise à jour récente.
                    </div>`;
            })
            .catch(err => console.error('Erreur lors du chargement des mises à jour:', err));
    }

    // Charger au démarrage
    fetchUpdates();
    // Recharger toutes les 60 secondes
    setInterval(fetchUpdates, 60000);
});
</script>

<style>
.text-gold { color: gold; }
.border-gold { border: 1px solid gold !important; }
.card { border-radius: 12px; }
.card-header { font-weight: bold; font-size: 1.1rem; }
.card-body p { margin: 0.3rem 0; }
</style>
@endpush







